(function(){window.JamfPlugin=function(){var self=this;this.commands={};this.translations={};this.dialog_confirm_command=null;this.dialog_send_command=null;this.jamf_id=-1;this.ajax_root="";this.init=function(args){if(args!==undefined&&args.commands!==undefined){self.commands=args.commands;self.jamf_id=args.jamf_id}self.ajax_root=CFG_GLPI.root_doc+"/plugins/jamf/ajax/";$.ajax({method:"GET",url:self.ajax_root+"getTranslations.php"}).done(function(data){self.translations=data})};this.onMDMCommandButtonClick=function(command,event){event.preventDefault();if(self.commands[command]!==undefined){if(self.commands[command]["params"]!==undefined){showMDMCommandForm(command)}else if(self.commands[command]["confirm"]!==undefined&&self.commands[command]["confirm"]===true){showMDMCommandConfirmation(command)}else{self.sendMDMCommand(command)}}};var showMDMCommandForm=function(command){$.ajax({method:"GET",url:self.ajax_root+"getMDMCommandForm.php",data:{command:command}}).done(function(data){if(data!==undefined&&data!==null){if(self.dialog_send_command!==undefined&&self.dialog_send_command!==null){self.dialog_send_command.remove()}self.dialog_send_command=$(data).appendTo("#page");self.dialog_send_command.dialog({autoOpen:false,modal:true,close:function(){self.dialog_send_command.remove()}});self.dialog_send_command.dialog({buttons:{Send:function(){if(self.commands[command]["confirm"]!==undefined&&self.commands[command]["confirm"]===true){showMDMCommandConfirmation(command,self.dialog_send_command.serialize())}else{self.sendMDMCommand(command,self.dialog_send_command.serialize())}},Cancel:function(){$(this).dialog("close")}}});self.dialog_send_command.dialog("open")}})};var showMDMCommandConfirmation=function(command,params){if(self.dialog_confirm_command===undefined||self.dialog_confirm_command===null){self.dialog_confirm_command=$("<div id='jamf-mdmcommand-confirm'></div>").appendTo("#page");$(document).ready(function(){$("#jamf-mdmcommand-confirm").dialog({autoOpen:false,modal:true,close:function(){self.dialog_confirm_command.remove()}})})}self.dialog_confirm_command.dialog({buttons:{Confirm:function(){self.sendMDMCommand(command,params)},Cancel:function(){$(this).dialog("close")}}});var warn_text=self.translations["Are you sure you want to send the command: %s?"].replace("%s",self.commands[command].name);self.dialog_confirm_command.text(warn_text);self.dialog_confirm_command.dialog("open")};this.sendMDMCommand=function(command,params){if(params===undefined){params=""}$.ajax({method:"POST",url:self.ajax_root+"sendMDMCommand.php",data:{command:command,fields:params,jamf_id:self.jamf_id}}).always(function(){location.reload()})}}})();